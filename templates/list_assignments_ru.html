{% extends "bootstrap/base.html" %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('send_asset', path='js/process_autograded_status.js') }}"></script>
{% endblock %}

{% block content %}
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<div class="row-fluid">
    <div class="col-sm-8 col-sm-offset-2">
        <h1>Задания</h1>
        {% for course in mycourses %}
            {% if course['active'] %}
            <h2>{{ course['description'] }}</h2>
            <table class="table table-striped table-bordered table-hove">
                <tr>
                    <th>
                        Задание
                    </th>
                    <th>Срок сдачи</th>
                    <th>Загруженные работы</th>
                </tr>
                {% for assignment in course['assignments'] %}
                {% if assignment['data'].active %}
                    <tr>
                        <td>
                            {{ assignment['data'].description }} [<a href="{{ assignment['data'].ipynb_link() }}">ipynb</a>]
                            [<a href="{{ assignment['data'].ipynb_link(preview=True) }}">preview</a>]
                        </td>
                        <td>
                            {{ assignment['data'].deadline.strftime("%Y-%m-%d %H:%M:%S") }}
                        </td>
                        <td>
                        {% if assignment['submissions'] %}

                        <ul>
                            {% for submission in assignment['submissions'] %}
                            <li>
                                <a href="{{ url_for("get_submission_content", id=submission.id) }}">
                                #{{ submission.id }}
                                </a> ({{ submission.timestamp }})
                                <br/><span class="process_autograded_status"
                                           data-submission-id="{{ submission.id }}"
                                           data-autograded-status="{{ submission.autograded_status }}">
                                     </span>
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                            <a href="{{ url_for("submit_assignment", id=assignment['data'].id) }}">загрузить работу</a>
                        </td>
                    </tr>
                {% endif %}
                {% endfor %}
            </table>
            {% endif %}
        {% endfor %}
        {% if message %}
        <h3>Сообщение</h3>
        <p>{{ message | safe }}</p>
        {% endif %}
        </div>
</div>

<p>
<a href="{{ url_for('security.logout') }}">Выйти из системы</a>
    </p>
{% endblock %}